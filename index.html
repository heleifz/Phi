<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

<meta charset="utf-8">
<title>Phi 简介</title>
<meta name="description" content="">
<meta name="author" content="">

<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/css/skeleton.css">
<link rel="stylesheet" href="/css/layout.css">
<link rel="stylesheet" href="/css/prism.css">
<script src="/js/prism.js"></script>
<link rel="shortcut icon" href="/favicon.ico">

</head>
<body>
	<div class="container">
			<div class="sixteen columns">
			<h1 class="remove-bottom" style="margin-top: 40px">Phi</h1>
			<h5>A Static Site Generator</h5>
			<hr />
		</div>
		<div class="two-thirds column">
			<h2>简介</h2>
<p>Phi (fai - 第四声) 是一个基于 PHP5.4 和 Twig 模版引擎的静态站点生成器。它默认支持 markdown 和 HTML 两种标记语言，并能通过简洁的插件系统方便地实现功能的扩展。</p>
<h2>安装</h2>
<p>为了使用 Phi，首先得下载 <a href="http://getcomposer.org">Composer</a> 进行依赖包的安装，下载完毕后，运行以下指令更新所有依赖包：</p>
<pre><code class="language-bash">php composer.phar update</code></pre>
<p>更新完毕后，就可以直接使用了。当然，为了保持您系统的整洁，建议运行<code>compile.php</code>将整个项目打包成 .phar 文件，在运行之前，必须关闭 php 配置文件中的 <code>phar.readonly</code> 项，或者直接在命令行里配置该选项，像这样：</p>
<pre><code class="language-bash">php -d phar.readonly=0 compile.php</code></pre>
<p>稍等片刻后，phi.phar 文件就可以用了。</p>
<h2>使用</h2>
<p>Phi 的所有指令都可以使用 <code>php phi.phar &lt;指令名&gt; --help</code> 来获取帮助。</p>
<h3>脚手架</h3>
<p>像其它静态站点生成器一样，使用的第一步是创建项目的基本框架，Phi 的 scaffold 指令实现了这一功能。（使用前请保证目标文件夹不存在或为空）</p>
<pre><code class="language-bash">php phi.phar scaffold &lt;目标文件夹名&gt;</code></pre>
<p>站点包含以下几个文件夹：</p>
<ol>
<li>articles 放置文章</li>
<li>assets 放置 CSS、JS、图片等资源文件</li>
<li>plugins 放置插件脚本</li>
<li>templates 放置 Twig 模版文件</li>
<li>site 放置编译生成的站点</li>
</ol>
<h3>写文章</h3>
<p>生成站点脚手架后，就可以在 articles 目录里写文章了（所有目录的名称都是可以在 config.yml 里改的哦），文章的文件名遵循和 Jekyll 一样的 “年-月-日-标题” 的形式，如果格式不对，系统默认采用文件的修改时间作为日期，采用文件名作为标题。</p>
<p>在文章开头，可以使用一对<code>---</code>来包含额外的元数据（YAML格式），例如：</p>
<pre><code class="language-markdown">---
url : :dir/:name.html
title : 文章标题
template : sometemplate.html
---

正文内容...
</code></pre>
<p>其中，变量<code>:dir</code>指的是当前文件在 articles 文件夹中的相对位置，<code>:name</code>指的是文件名中除了日期以外的部分。在这个例子中，文章的 URL ，标题，以及使用的模版被重新设定了。（默认的 URL 是 <code>年/月/日/标题.html</code>）</p>
<p>Phi 目前有一个小feature（或者是小BUG）：文章中可以使用 Twig 的变量。它的好处是能更好地控制文章中的 URL，坏处就是...文章中无法直接显示 Twig 代码。</p>
<h3>设计模版</h3>
<p>Phi 采用 <a href="http://twig.sensiolabs.org">Twig</a> 作为模版引擎，所以用法和 Twig 一样。值得一提的是，我往其中加了一些扩展，例如 <code>where</code>，<code>group_by</code>，<code>sort_by</code>语句用于过滤文章列表，<code>js</code>，<code>css</code>等 tag 用于方便地插入资源文件。</p>
<p>在一个模版中：page 是当前页的文章，你可以：</p>
<ul>
<li><em>page.content</em></li>
<li><em>page.title</em></li>
<li><em>page.url</em></li>
<li><em>page.previous_article</em></li>
<li><em>page.next_article</em></li>
<li><em>etc...</em></li>
</ul>
<p>site 是整站配置及文章列表</p>
<ul>
<li><em>site.config 可以访问配置项</em></li>
<li><em>site.articles 是文章列表</em></li>
</ul>
<h3>配置文件</h3>
<p>默认的YAML配置文件内容如下，</p>
<pre><code class="language-bash">name : Phi
source : articles
destination : site
assets : assets
templates : templates
root : 
generator : twig
encoding : utf-8
plugins : plugins
timezone: America/New_York
exclude_name :
exclude_path : 
defaults:
    - pattern : *
      meta : 
          title : :name
          url : :date/:name.html
          template : article.html</code></pre>
<p>可以看到，项目文件夹里的每个文件夹名都可以随意配置，此外，Phi 还拥有 exclude_name 等选项。这些选项都是项目的全局配置，可以在 config.yml 里覆盖。</p>
<p>这里一个有意思的配置是 defaults 选项，这是一个从上到下的 pattern matching 的过程，pattern 指的是文章相对地址的 pattern （不是正则表达式，是 Linux 的 wildcard），meta 指的是，在文章满足该 pattern 时，文章的属性值。</p>
<p>我们可以利用 defaults 选项来批量配置某个子文件夹里的所有文章。</p>
<h3>添加扩展</h3>
<pre><code class="language-bash">php phi.phar plugin -type parser -name abc &lt;项目文件夹&gt;</code></pre>
<p>这条指令会在项目的 plugins 目录中添加一个新的 parser，并准备好一些基本的代码：</p>
<pre><code class="language-php">class AbcParser implements \Phi\Parser {

    public function getExtensions() {
        // array of document type
        return array();
    }

    public function parse($text) {
        // text transformation
        return $text;
    }
}</code></pre>
<p>您所需要做的有两件事，一是在 <code>getExtensions</code> 函数里返回这个 parser 所支持的文件扩展名，二是在 parse 函数里进行文本的转换。（具体的例子可以参考 Phi 的 markdown parser 的写法，超简单）。</p>
<h3>*asset* 模版</h3>
<p>Phi 提供了一种特殊的模版 <code>*asset*</code>，使用该模版的文件将不会出现在最终的文章列表里，且文件将被直接 parse，不经过任何模版转换。像CoffeeScript，LESS等资源文件可以使用*asset*模版进行直接转换。</p>
<h3>生成站点</h3>
<pre><code class="language-bash">php phi.phar generate &lt;项目文件夹&gt;</code></pre>
<p>就是这么简单。</p>
		</div>
		<div class="one-third column">
			<h4>文章列表</h4>
			<ul class="square">
									<a href="/index.html">
						<li>
							<strong>Phi 简介</strong>&nbsp;&nbsp;
							Phi (fai - 第四声) 是一个基于 PHP5.4 和 Twig 模版引擎的静态站点生成器。它
						</li>
					</a>
							</ul>
		</div>
	</div>
</body>
</html>
